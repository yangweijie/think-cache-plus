# ThinkCache Plus

<div align="center">

![ThinkCache Plus Logo](https://img.shields.io/badge/ThinkCache-Plus-blue?style=for-the-badge)
[![PHP Version](https://img.shields.io/badge/PHP-%3E%3D7.1-777BB4?style=flat-square&logo=php)](https://php.net)
[![ThinkPHP Version](https://img.shields.io/badge/ThinkPHP-%3E%3D6.0-green?style=flat-square)](https://thinkphp.cn)
[![License](https://img.shields.io/badge/License-MIT-yellow?style=flat-square)](LICENSE)
[![Tests](https://img.shields.io/badge/Tests-24%20Passed-success?style=flat-square)](tests)

**ä¸€ä¸ªå¼ºå¤§çš„ ThinkPHP ç¼“å­˜æ‰©å±•åŒ…ï¼Œæä¾›ç¼“å­˜å˜æ›´äº‹ä»¶ç›‘å¬å’Œå¯è§†åŒ–ç®¡ç†ç•Œé¢**

[åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§) â€¢ [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹) â€¢ [æ–‡æ¡£](#æ–‡æ¡£) â€¢ [API](#api-æ¥å£) â€¢ [æµ‹è¯•](#æµ‹è¯•)

</div>

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ” **æ™ºèƒ½ç›‘å¬**
- **è‡ªåŠ¨äº‹ä»¶ç›‘å¬** - æ— ä¾µå…¥å¼ç›‘å¬ç¼“å­˜çš„å†™å…¥ã€åˆ é™¤ã€æ¸…ç©ºæ“ä½œ
- **ç²¾ç¡®è°ƒç”¨è¿½è¸ª** - è®°å½•ç¼“å­˜æ“ä½œçš„æ–‡ä»¶è·¯å¾„å’Œè¡Œå·
- **é—­åŒ…å†…å®¹æå–** - æ™ºèƒ½æå– `remember()` é—­åŒ…å‡½æ•°ä½“å†…å®¹
- **å†…å®¹å®Œæ•´æ€§** - æ”¯æŒå†…å®¹ MD5 æ ¡éªŒå’Œé‡å¤æ£€æµ‹

### ğŸ·ï¸ **æ ‡ç­¾ç®¡ç†**
- **æ ‡ç­¾åˆ†ç»„** - æ”¯æŒæŒ‰æ ‡ç­¾åˆ†ç»„ç®¡ç†ç¼“å­˜
- **æ‰¹é‡æ“ä½œ** - æŒ‰æ ‡ç­¾æ‰¹é‡åˆ é™¤ç¼“å­˜
- **æ ‡ç­¾ç»Ÿè®¡** - å®æ—¶ç»Ÿè®¡å„æ ‡ç­¾ä¸‹çš„ç¼“å­˜æ•°é‡

### ğŸ“Š **å¯è§†åŒ–ç•Œé¢**
- **ç°ä»£åŒ–è®¾è®¡** - åŸºäº TailwindCSS çš„å“åº”å¼ç•Œé¢
- **å®æ—¶ç»Ÿè®¡** - ç¼“å­˜æ•°é‡ã€å¤§å°ã€å‘½ä¸­ç‡ç­‰ç»Ÿè®¡ä¿¡æ¯
- **æ“ä½œå†å²** - å®Œæ•´çš„ç¼“å­˜æ“ä½œæ—¶é—´çº¿
- **æœç´¢è¿‡æ»¤** - æ”¯æŒæŒ‰é”®åã€æ ‡ç­¾ã€æ“ä½œç±»å‹æœç´¢

### ğŸ—‚ï¸ **æ•°æ®ç®¡ç†**
- **å¤šç‰ˆæœ¬è®°å½•** - åŒä¸€ä¸ª key å¯ä»¥è®°å½•å¤šæ¡å˜æ›´å†å²
- **æ‰¹é‡æ“ä½œ** - æ”¯æŒæ‰¹é‡åˆ é™¤ç¼“å­˜å’ŒæŒ‰æ ‡ç­¾æ¸…ç†
- **æ•°æ®å¯¼å‡º** - æ”¯æŒå¯¼å‡ºç¼“å­˜æ•°æ®å’Œæ“ä½œæ—¥å¿—
- **è‡ªåŠ¨æ¸…ç†** - å¯é…ç½®çš„è¿‡æœŸæ—¥å¿—è‡ªåŠ¨æ¸…ç†

### âš¡ **æ€§èƒ½ä¼˜åŒ–**
- **å¼‚æ­¥è®°å½•** - æ”¯æŒå¼‚æ­¥æ—¥å¿—è®°å½•ï¼Œä¸å½±å“ä¸»ä¸šåŠ¡æ€§èƒ½
- **æ™ºèƒ½è¿‡æ»¤** - å¯é…ç½®æ’é™¤ç›‘å¬çš„ç¼“å­˜é”®å’Œæ–‡ä»¶
- **æ‰¹é‡å†™å…¥** - ä¼˜åŒ–çš„æ‰¹é‡æ•°æ®åº“å†™å…¥
- **å†…å­˜ä¼˜åŒ–** - æ™ºèƒ½å†…å­˜ç®¡ç†ï¼Œé¿å…å†…å­˜æ³„æ¼

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ“¦ å®‰è£…

ä½¿ç”¨ Composer å®‰è£…ï¼š

```bash
composer require yangweijie/think-cache-plus
```

### âš™ï¸ ä¸€é”®å®‰è£…ï¼ˆæ¨èï¼‰

ä½¿ç”¨å†…ç½®å®‰è£…å‘½ä»¤ï¼Œè‡ªåŠ¨å®Œæˆæ‰€æœ‰é…ç½®ï¼š

```bash
# åŸºç¡€å®‰è£…
php think cache-plus:install

# å¼ºåˆ¶è¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶
php think cache-plus:install --force
```

### ğŸ”§ æ‰‹åŠ¨é…ç½®

å¦‚æœéœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

#### 1. å‘å¸ƒé…ç½®æ–‡ä»¶

```bash
php think vendor:publish --tag=config
```

#### 2. è¿è¡Œæ•°æ®åº“è¿ç§»

```bash
php think migrate:run
```

#### 3. å‘å¸ƒé™æ€èµ„æºï¼ˆå¯é€‰ï¼‰

```bash
php think vendor:publish --tag=assets
```

#### 4. æ³¨å†ŒæœåŠ¡æä¾›è€…

åœ¨ `config/app.php` ä¸­æ·»åŠ æœåŠ¡æä¾›è€…ï¼š

```php
'providers' => [
    // å…¶ä»–æœåŠ¡...
    \yangweijie\cache\Service::class,
],
```

## ğŸ“– æ–‡æ¡£

### ğŸ¯ åŸºæœ¬é…ç½®

åœ¨ `config/cache_plus.php` ä¸­é…ç½®æ‰©å±•åŒ…ï¼š

```php
return [
    // æ˜¯å¦å¯ç”¨ç¼“å­˜ç›‘å¬
    'enable_listener' => true,

    // æ—¥å¿—ä¿ç•™å¤©æ•°ï¼ˆè‡ªåŠ¨æ¸…ç†ï¼‰
    'log_retention_days' => 30,

    // æ˜¯å¦è®°å½•é—­åŒ…å†…å®¹
    'log_closure_content' => true,

    // ç®¡ç†ç•Œé¢é…ç½®
    'admin' => [
        'enable' => true,              // æ˜¯å¦å¯ç”¨ç®¡ç†ç•Œé¢
        'password' => '',              // è®¿é—®å¯†ç ï¼Œä¸ºç©ºåˆ™ä¸éœ€è¦å¯†ç 
        'page_size' => 20,             // æ¯é¡µæ˜¾ç¤ºæ•°é‡
        'show_cache_value' => true,    // æ˜¯å¦æ˜¾ç¤ºç¼“å­˜å€¼
        'max_value_display_length' => 1000, // ç¼“å­˜å€¼æœ€å¤§æ˜¾ç¤ºé•¿åº¦
    ],

    // æ’é™¤ç›‘å¬çš„ç¼“å­˜keyæ¨¡å¼ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰
    'exclude_key_patterns' => [
        '/^session_/',
        '/^csrf_token_/',
        '/^captcha_/',
    ],

    // æ’é™¤ç›‘å¬çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰
    'exclude_file_patterns' => [
        '/vendor\//',
        '/runtime\//',
        '/storage\//',
    ],

    // æœ€å¤§é—­åŒ…å†…å®¹é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰
    'max_closure_content_length' => 10240,

    // æ€§èƒ½é…ç½®
    'performance' => [
        'enable_monitoring' => true,        // æ˜¯å¦å¯ç”¨æ€§èƒ½ç›‘æ§
        'log_throttle_seconds' => 0,       // æ—¥å¿—è®°å½•é¢‘ç‡é™åˆ¶ï¼ˆç§’ï¼‰
        'log_stack_trace' => true,         // æ˜¯å¦è®°å½•è°ƒç”¨æ ˆä¿¡æ¯
    ],
];
```

### ğŸ–¥ï¸ è®¿é—®ç®¡ç†ç•Œé¢

å¯åŠ¨åº”ç”¨åï¼Œè®¿é—® `/cache-plus` å³å¯è¿›å…¥ç¼“å­˜ç®¡ç†ç•Œé¢ã€‚

#### ğŸ” å®‰å…¨é…ç½®

```php
// å¯ç”¨å¯†ç ä¿æŠ¤
'admin' => [
    'enable' => true,
    'password' => 'your_secure_password',  // è®¾ç½®è®¿é—®å¯†ç 
],
```

è®¿é—®æ—¶éœ€è¦åœ¨URLä¸­æ·»åŠ å¯†ç å‚æ•°ï¼š
```
http://your-domain.com/cache-plus?password=your_secure_password
```

#### ğŸ›ï¸ ç•Œé¢å®šåˆ¶

```php
'admin' => [
    'page_size' => 50,                     // æ¯é¡µæ˜¾ç¤º50æ¡è®°å½•
    'show_cache_value' => false,           // éšè—ç¼“å­˜å€¼ï¼ˆæå‡å®‰å…¨æ€§ï¼‰
    'max_value_display_length' => 500,     // é™åˆ¶æ˜¾ç¤ºé•¿åº¦
],
```

![ç®¡ç†ç•Œé¢æˆªå›¾](https://via.placeholder.com/800x400/4F46E5/FFFFFF?text=ThinkCache+Plus+ç®¡ç†ç•Œé¢)

### ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

#### åŸºæœ¬ç¼“å­˜æ“ä½œ

```php
use yangweijie\cache\facade\CacheWithEvents;

// æ™®é€šç¼“å­˜æ“ä½œï¼ˆä¼šè‡ªåŠ¨è®°å½•ï¼‰
CacheWithEvents::set('user:1', $userData, 3600);
CacheWithEvents::get('user:1');
CacheWithEvents::delete('user:1');

// ä½¿ç”¨é—­åŒ…ç¼“å­˜ï¼ˆä¼šè®°å½•é—­åŒ…å†…å®¹ï¼‰
$user = CacheWithEvents::remember('user:' . $id, function() use ($id) {
    return User::find($id);
}, 3600);
```

#### æ ‡ç­¾ç¼“å­˜æ“ä½œ

```php
// ä½¿ç”¨æ ‡ç­¾
CacheWithEvents::tags(['user', 'profile'])->set('user:1:profile', $profile);

// æŒ‰æ ‡ç­¾åˆ é™¤
CacheWithEvents::tags(['user'])->flush();

// é“¾å¼è°ƒç”¨
$data = CacheWithEvents::tags(['api', 'external'])
    ->remember('api:weather', function() {
        return $this->fetchWeatherData();
    }, 1800);
```

## ğŸ”Œ API æ¥å£

æ‰©å±•åŒ…æä¾›äº†å®Œæ•´çš„ REST APIï¼Œæ”¯æŒ JSON å“åº”ï¼š

### ğŸ“‹ ç¼“å­˜ç®¡ç† API

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° | å‚æ•° |
|------|------|------|------|
| `GET` | `/cache-plus/api/list` | è·å–ç¼“å­˜åˆ—è¡¨ | `page`, `limit`, `key` |
| `GET` | `/cache-plus/api/detail` | è·å–ç¼“å­˜è¯¦æƒ… | `key` |
| `DELETE` | `/cache-plus/api/delete` | åˆ é™¤æŒ‡å®šç¼“å­˜ | `key` |
| `DELETE` | `/cache-plus/api/batch-delete` | æ‰¹é‡åˆ é™¤ç¼“å­˜ | `keys[]` |
| `DELETE` | `/cache-plus/api/clear` | æ¸…ç©ºæ‰€æœ‰ç¼“å­˜ | - |

### ğŸ·ï¸ æ ‡ç­¾ç®¡ç† API

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° | å‚æ•° |
|------|------|------|------|
| `GET` | `/cache-plus/api/tags` | è·å–æ‰€æœ‰æ ‡ç­¾ | - |
| `DELETE` | `/cache-plus/api/delete-by-tag` | æŒ‰æ ‡ç­¾åˆ é™¤ç¼“å­˜ | `tag` |

### ğŸ“Š ç»Ÿè®¡å’Œæ—¥å¿— API

| æ–¹æ³• | ç«¯ç‚¹ | æè¿° | å‚æ•° |
|------|------|------|------|
| `GET` | `/cache-plus/api/statistics` | è·å–ç»Ÿè®¡ä¿¡æ¯ | - |
| `GET` | `/cache-plus/api/logs` | è·å–æ“ä½œæ—¥å¿— | `page`, `limit` |
| `POST` | `/cache-plus/api/clean-logs` | æ¸…ç†è¿‡æœŸæ—¥å¿— | `days`, `password` |
| `GET` | `/cache-plus/api/config` | è·å–é…ç½®ä¿¡æ¯ | `password` |

### ğŸ“ API ä½¿ç”¨ç¤ºä¾‹

```javascript
// è·å–ç¼“å­˜åˆ—è¡¨
fetch('/cache-plus/api/list?page=1&limit=20')
  .then(response => response.json())
  .then(data => console.log(data));

// åˆ é™¤ç¼“å­˜
fetch('/cache-plus/api/delete?key=user:1', {
  method: 'DELETE'
}).then(response => response.json());

// æ‰¹é‡åˆ é™¤
fetch('/cache-plus/api/batch-delete', {
  method: 'DELETE',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ keys: ['user:1', 'user:2'] })
});

// æ¸…ç†è¿‡æœŸæ—¥å¿—
fetch('/cache-plus/api/clean-logs', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    days: 7,  // ä¿ç•™7å¤©
    password: 'your_password'  // å¦‚æœè®¾ç½®äº†å¯†ç 
  })
});

// è·å–é…ç½®ä¿¡æ¯
fetch('/cache-plus/api/config?password=your_password')
  .then(response => response.json())
  .then(data => console.log(data));
```

### ğŸ› ï¸ ç¼–ç¨‹æ¥å£

```php
use yangweijie\cache\controller\CacheController;

// è·å–æ§åˆ¶å™¨å®ä¾‹
$controller = new CacheController();

// è·å–ç¼“å­˜åˆ—è¡¨
$list = $controller->getCacheList($page = 1, $limit = 20);

// è·å–ç¼“å­˜è¯¦æƒ…
$detail = $controller->getCacheDetail('user:1');

// åˆ é™¤ç¼“å­˜
$result = $controller->deleteCache('user:1');

// è·å–ç»Ÿè®¡ä¿¡æ¯
$stats = $controller->getStatistics();
```

## ğŸ§ äº‹ä»¶ç›‘å¬

### ğŸ“¡ è‡ªåŠ¨ç›‘å¬äº‹ä»¶

æ‰©å±•åŒ…ä¼šè‡ªåŠ¨ç›‘å¬ä»¥ä¸‹ç¼“å­˜äº‹ä»¶ï¼š

| äº‹ä»¶ | è§¦å‘æ—¶æœº | è®°å½•å†…å®¹ |
|------|----------|----------|
| `cache.write` | ç¼“å­˜å†™å…¥/æ›´æ–° | é”®åã€å€¼ã€è¿‡æœŸæ—¶é—´ã€è°ƒç”¨ä½ç½® |
| `cache.delete` | ç¼“å­˜åˆ é™¤ | é”®åã€è°ƒç”¨ä½ç½® |
| `cache.clear` | ç¼“å­˜æ¸…ç©º | æ¸…ç©ºèŒƒå›´ã€è°ƒç”¨ä½ç½® |
| `cache.flush` | æ ‡ç­¾æ¸…ç©º | æ ‡ç­¾ä¿¡æ¯ã€è°ƒç”¨ä½ç½® |

### ğŸ“ è®°å½•ä¿¡æ¯

æ¯æ¬¡æ“ä½œéƒ½ä¼šè¯¦ç»†è®°å½•ï¼š

- **ğŸ”‘ ç¼“å­˜ä¿¡æ¯** - é”®åã€å€¼ã€è¿‡æœŸæ—¶é—´ã€æ ‡ç­¾
- **ğŸ“ è°ƒç”¨è¿½è¸ª** - æ–‡ä»¶è·¯å¾„ã€è¡Œå·ã€è°ƒç”¨æ ˆ
- **ğŸ”’ å†…å®¹å®Œæ•´æ€§** - é—­åŒ…å†…å®¹ã€MD5 æ ¡éªŒ
- **ğŸŒ è¯·æ±‚ä¸Šä¸‹æ–‡** - URIã€User-Agentã€æ—¶é—´æˆ³
- **ğŸ·ï¸ åˆ†ç±»æ ‡ç­¾** - æ”¯æŒå¤šæ ‡ç­¾åˆ†ç»„ç®¡ç†

### ğŸ¯ é—­åŒ…å†…å®¹æå–

**é‡è¦ç‰¹æ€§**ï¼šæ™ºèƒ½æå– `remember()` é—­åŒ…å‡½æ•°ä½“å†…å®¹

```php
// ç¤ºä¾‹ä»£ç 
CacheWithEvents::remember('user:' . $id, function() use ($id) {
    return User::find($id);
});

// è®°å½•çš„ closure_content å­—æ®µå†…å®¹ï¼š
// "return User::find($id);"  â† å‡½æ•°ä½“å†…å®¹ï¼Œä¸æ˜¯ç¼“å­˜å€¼
```

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

### ğŸ“Š cache_log è¡¨ç»“æ„

| å­—æ®µ | ç±»å‹ | ç´¢å¼• | è¯´æ˜ |
|------|------|------|------|
| `id` | `bigint` | PRIMARY | ä¸»é”® |
| `cache_key` | `varchar(255)` | INDEX | ç¼“å­˜é”®å |
| `operation` | `varchar(20)` | INDEX | æ“ä½œç±»å‹ (write/delete/clear) |
| `file_path` | `varchar(500)` | - | è°ƒç”¨æ–‡ä»¶è·¯å¾„ |
| `line_number` | `int` | - | è°ƒç”¨è¡Œå· |
| `closure_content` | `text` | - | é—­åŒ…å†…å®¹æˆ–ç¼“å­˜å€¼ |
| `content_md5` | `varchar(32)` | INDEX | å†…å®¹ MD5 æ ¡éªŒ |
| `tags` | `json` | - | ç¼“å­˜æ ‡ç­¾ (JSON æ ¼å¼) |
| `expire_time` | `int` | - | è¿‡æœŸæ—¶é—´æˆ³ |
| `request_uri` | `varchar(500)` | - | è¯·æ±‚ URI |
| `user_agent` | `varchar(500)` | - | ç”¨æˆ·ä»£ç† |
| `created_at` | `datetime` | INDEX | åˆ›å»ºæ—¶é—´ |
| `updated_at` | `datetime` | - | æ›´æ–°æ—¶é—´ |

### ğŸ” ç´¢å¼•ä¼˜åŒ–

```sql
-- ä¸»è¦æŸ¥è¯¢ç´¢å¼•
INDEX `idx_cache_key` (`cache_key`)
INDEX `idx_operation` (`operation`)
INDEX `idx_created_at` (`created_at`)
INDEX `idx_content_md5` (`content_md5`)

-- å¤åˆç´¢å¼•
INDEX `idx_key_operation` (`cache_key`, `operation`)
INDEX `idx_operation_time` (`operation`, `created_at`)
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### ğŸš€ æ ¸å¿ƒä¼˜åŒ–ç‰¹æ€§

- **æ™ºèƒ½è¿‡æ»¤æœºåˆ¶** - å¯é…ç½®æ’é™¤ç‰¹å®šç¼“å­˜é”®å’Œæ–‡ä»¶
- **é¢‘ç‡é™åˆ¶æ§åˆ¶** - é˜²æ­¢é«˜é¢‘æ“ä½œäº§ç”Ÿå¤§é‡æ—¥å¿—
- **å†…å®¹é•¿åº¦é™åˆ¶** - é˜²æ­¢è¿‡å¤§çš„é—­åŒ…å†…å®¹å½±å“æ€§èƒ½
- **æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤** - çµæ´»çš„é”®åå’Œæ–‡ä»¶è·¯å¾„è¿‡æ»¤
- **é…ç½®åŒ–æ§åˆ¶** - å¯å®Œå…¨å…³é—­ç›‘å¬åŠŸèƒ½
- **è‡ªåŠ¨æ—¥å¿—æ¸…ç†** - å®šæœŸæ¸…ç†è¿‡æœŸæ—¥å¿—æ•°æ®
- **å¼‚å¸¸å¤„ç†** - ç›‘å¬å™¨é”™è¯¯ä¸å½±å“ä¸»ä¸šåŠ¡

### âš™ï¸ æ€§èƒ½é…ç½®

```php
// config/cache_plus.php
return [
    // æ˜¯å¦å¯ç”¨ç¼“å­˜ç›‘å¬
    'enable_listener' => true,

    // æ˜¯å¦è®°å½•é—­åŒ…å†…å®¹
    'log_closure_content' => true,

    // æœ€å¤§é—­åŒ…å†…å®¹é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰
    'max_closure_content_length' => 10240,

    // æ’é™¤ç›‘å¬çš„ç¼“å­˜keyæ¨¡å¼ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰
    'exclude_key_patterns' => [
        '/^session_/',      // æ’é™¤ session ç›¸å…³ç¼“å­˜
        '/^csrf_token_/',   // æ’é™¤ CSRF token
        '/^captcha_/',      // æ’é™¤éªŒè¯ç ç¼“å­˜
        '/^temp_/',         // æ’é™¤ä¸´æ—¶ç¼“å­˜
    ],

    // æ’é™¤ç›‘å¬çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰
    'exclude_file_patterns' => [
        '/vendor\//',       // æ’é™¤ç¬¬ä¸‰æ–¹åŒ…
        '/runtime\//',      // æ’é™¤è¿è¡Œæ—¶æ–‡ä»¶
        '/storage\//',      // æ’é™¤å­˜å‚¨ç›®å½•
        '/cache\//',        // æ’é™¤ç¼“å­˜ç›®å½•
    ],

    // æ€§èƒ½ä¼˜åŒ–é…ç½®
    'performance' => [
        'enable_monitoring' => true,        // å¯ç”¨æ€§èƒ½ç›‘æ§
        'log_throttle_seconds' => 60,      // åŒä¸€ç¼“å­˜é”®60ç§’å†…åªè®°å½•ä¸€æ¬¡
        'log_stack_trace' => false,        // å…³é—­è°ƒç”¨æ ˆè®°å½•ï¼ˆæå‡æ€§èƒ½ï¼‰
    ],
];
```

### ğŸ¯ è¿‡æ»¤è§„åˆ™è¯´æ˜

#### **ç¼“å­˜é”®è¿‡æ»¤**
```php
// ç¤ºä¾‹ï¼šè¿™äº›ç¼“å­˜é”®ä¼šè¢«æ’é™¤ç›‘å¬
'session_abc123'        // åŒ¹é… /^session_/
'csrf_token_xyz'        // åŒ¹é… /^csrf_token_/
'captcha_12345'         // åŒ¹é… /^captcha_/
```

#### **æ–‡ä»¶è·¯å¾„è¿‡æ»¤**
```php
// ç¤ºä¾‹ï¼šè¿™äº›æ–‡ä»¶çš„ç¼“å­˜æ“ä½œä¼šè¢«æ’é™¤
'/vendor/topthink/framework/src/Cache.php'  // åŒ¹é… /vendor\//
'/app/runtime/cache/temp.php'               // åŒ¹é… /runtime\//
'/storage/logs/cache.log'                   // åŒ¹é… /storage\//
```

### ğŸ—‚ï¸ æ—¥å¿—ç®¡ç†

#### **è‡ªåŠ¨æ¸…ç†é…ç½®**
```php
// é…ç½®æ—¥å¿—ä¿ç•™å¤©æ•°
'log_retention_days' => 7,  // åªä¿ç•™7å¤©çš„æ—¥å¿—

// è‡ªåŠ¨æ¸…ç†å°†åœ¨ä»¥ä¸‹æƒ…å†µè§¦å‘ï¼š
// 1. æ‰‹åŠ¨è°ƒç”¨ API æ¥å£
// 2. æ‰§è¡Œå‘½ä»¤è¡Œå·¥å…·
// 3. å¯é›†æˆåˆ°å®šæ—¶ä»»åŠ¡ä¸­
```

#### **å‘½ä»¤è¡Œæ¸…ç†**
```bash
# ä½¿ç”¨é…ç½®çš„ä¿ç•™å¤©æ•°æ¸…ç†
php think cache-plus:clean-logs

# æŒ‡å®šä¿ç•™å¤©æ•°
php think cache-plus:clean-logs --days=30

# å¼ºåˆ¶æ¸…ç†ï¼ˆä¸è¯¢é—®ç¡®è®¤ï¼‰
php think cache-plus:clean-logs --force

# æŸ¥çœ‹å¸®åŠ©
php think cache-plus:clean-logs --help
```

#### **API æ¸…ç†**
```bash
# ä½¿ç”¨é…ç½®çš„ä¿ç•™å¤©æ•°
curl -X POST "http://your-domain.com/cache-plus/api/clean-logs"

# æŒ‡å®šä¿ç•™å¤©æ•°
curl -X POST "http://your-domain.com/cache-plus/api/clean-logs" \
  -H "Content-Type: application/json" \
  -d '{"days": 15}'

# å¸¦å¯†ç è®¿é—®
curl -X POST "http://your-domain.com/cache-plus/api/clean-logs" \
  -H "Content-Type: application/json" \
  -d '{"days": 15, "password": "your_password"}'
```

#### **å®šæ—¶ä»»åŠ¡é›†æˆ**
```bash
# æ·»åŠ åˆ° crontabï¼Œæ¯å¤©å‡Œæ™¨2ç‚¹æ¸…ç†è¿‡æœŸæ—¥å¿—
0 2 * * * cd /path/to/your/project && php think cache-plus:clean-logs --force

# æ¯å‘¨æ¸…ç†ä¸€æ¬¡ï¼Œä¿ç•™30å¤©
0 2 * * 0 cd /path/to/your/project && php think cache-plus:clean-logs --days=30 --force
```

## ğŸ§ª æµ‹è¯•

æœ¬é¡¹ç›®ä½¿ç”¨ [Pest](https://pestphp.com/) ä½œä¸ºæµ‹è¯•æ¡†æ¶ï¼Œæä¾›äº†ç°ä»£åŒ–çš„æµ‹è¯•ä½“éªŒã€‚

### ğŸš€ è¿è¡Œæµ‹è¯•

```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
composer install --dev

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
./vendor/bin/pest

# è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶
./vendor/bin/pest tests/Feature
./vendor/bin/pest tests/Unit

# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
./vendor/bin/pest tests/Feature/CacheEventListenerTest.php

# ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
./vendor/bin/pest --coverage
```

### ğŸ“Š æµ‹è¯•ç»Ÿè®¡

```
âœ… Tests: 24 passed
â±ï¸ Time: 0.05s
ğŸ“ˆ Coverage: 95%+
```

### ğŸ“ æµ‹è¯•ç»“æ„

```
tests/
â”œâ”€â”€ Pest.php                    # Pest é…ç½®å’ŒåŠ©æ‰‹å‡½æ•°
â”œâ”€â”€ TestCase.php                # åŸºç¡€æµ‹è¯•ç±»
â”œâ”€â”€ Feature/                    # åŠŸèƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ CacheControllerTest.php # æ§åˆ¶å™¨åŠŸèƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ CacheEventListenerTest.php # äº‹ä»¶ç›‘å¬å™¨æµ‹è¯•
â”‚   â””â”€â”€ CacheLogTest.php        # æ—¥å¿—æ¨¡å‹æµ‹è¯•
â””â”€â”€ Unit/                       # å•å…ƒæµ‹è¯•
    â””â”€â”€ CacheHookTest.php       # ç¼“å­˜é’©å­å•å…ƒæµ‹è¯•
```

### ğŸ”§ æµ‹è¯•åŠ©æ‰‹å‡½æ•°

```php
// åˆ›å»ºæµ‹è¯•ç¼“å­˜æ•°æ®
$data = createTestCacheData('key', 'value');

// åˆ›å»ºæ¨¡æ‹Ÿè¯·æ±‚å¯¹è±¡
$request = createMockRequest(['param' => 'value']);

// æ¨¡æ‹Ÿ ThinkPHP ç¼“å­˜
mockThinkCache();
```

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

| ç»„ä»¶ | ç‰ˆæœ¬è¦æ±‚ | è¯´æ˜ |
|------|----------|------|
| **PHP** | `>= 7.1` | æ”¯æŒ PHP 7.1+ å’Œ PHP 8.x |
| **ThinkPHP** | `>= 6.0` | å…¼å®¹ ThinkPHP 6.0+ |
| **MySQL** | `>= 5.7` | éœ€è¦ JSON å­—æ®µæ”¯æŒ |
| **Composer** | `>= 2.0` | åŒ…ç®¡ç†å™¨ |

### ğŸ”§ å¼€å‘ä¾èµ–

| åŒ… | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| `pestphp/pest` | `^1.0` | æµ‹è¯•æ¡†æ¶ |
| `mockery/mockery` | `^1.0` | æ¨¡æ‹Ÿå¯¹è±¡ |

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº [MIT License](LICENSE) å¼€æºåè®®å‘å¸ƒã€‚

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼

### ğŸ› æŠ¥å‘Šé—®é¢˜

- ä½¿ç”¨ [GitHub Issues](../../issues) æŠ¥å‘Š Bug
- æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå¤ç°æ­¥éª¤
- åŒ…å«ç¯å¢ƒä¿¡æ¯ï¼ˆPHP ç‰ˆæœ¬ã€ThinkPHP ç‰ˆæœ¬ç­‰ï¼‰

### ğŸ’¡ åŠŸèƒ½å»ºè®®

- åœ¨ Issues ä¸­æå‡ºæ–°åŠŸèƒ½å»ºè®®
- è¯¦ç»†æè¿°åŠŸèƒ½éœ€æ±‚å’Œä½¿ç”¨åœºæ™¯
- æ¬¢è¿æä¾›è®¾è®¡æ€è·¯å’Œå®ç°æ–¹æ¡ˆ

### ğŸ”§ ä»£ç è´¡çŒ®

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

### ğŸ“ ä»£ç è§„èŒƒ

- éµå¾ª PSR-12 ç¼–ç æ ‡å‡†
- æ·»åŠ é€‚å½“çš„æ³¨é‡Šå’Œæ–‡æ¡£
- ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡
- ä¿æŒå‘åå…¼å®¹æ€§

## ğŸ“ˆ æ›´æ–°æ—¥å¿—

### ğŸ‰ v1.3.0 (Latest)
- âœ¨ å®ç°æ‰€æœ‰é…ç½®é¡¹çš„åŠŸèƒ½æ”¯æŒ
- ğŸ” æ–°å¢ç®¡ç†ç•Œé¢å¯†ç ä¿æŠ¤åŠŸèƒ½
- ğŸ—‚ï¸ æ·»åŠ è‡ªåŠ¨æ—¥å¿—æ¸…ç†åŠŸèƒ½
- âš¡ å®ç°æ€§èƒ½ç›‘æ§å’Œé¢‘ç‡é™åˆ¶
- ğŸ› ï¸ æ–°å¢å‘½ä»¤è¡Œæ—¥å¿—æ¸…ç†å·¥å…·
- ğŸ“Š å¢å¼º API æ¥å£ï¼ˆé…ç½®è·å–ã€æ—¥å¿—æ¸…ç†ï¼‰
- ğŸ›ï¸ æ”¯æŒç•Œé¢å®šåˆ¶ï¼ˆåˆ†é¡µã€ç¼“å­˜å€¼æ˜¾ç¤ºæ§åˆ¶ï¼‰

### v1.2.0
- âœ¨ æ–°å¢é—­åŒ…å†…å®¹æ™ºèƒ½æå–åŠŸèƒ½
- ğŸ”§ ä¿®å¤ç¼“å­˜è¯¦æƒ…å¼¹çª—æ ·å¼é—®é¢˜
- ğŸš€ æ·»åŠ  `--force` å®‰è£…é€‰é¡¹
- ğŸ“Š ä¼˜åŒ–ç®¡ç†ç•Œé¢ç”¨æˆ·ä½“éªŒ
- ğŸ§ª å®Œå–„æµ‹è¯•è¦†ç›–ç‡

### v1.1.0
- ğŸ·ï¸ å¢å¼ºæ ‡ç­¾ç®¡ç†åŠŸèƒ½
- ğŸ“± å“åº”å¼ç•Œé¢ä¼˜åŒ–
- âš¡ æ€§èƒ½ä¼˜åŒ–å’Œå†…å­˜ç®¡ç†
- ğŸ” æ”¹è¿›æœç´¢å’Œè¿‡æ»¤åŠŸèƒ½

### v1.0.0
- ğŸŠ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ğŸ” åŸºç¡€ç¼“å­˜ç›‘å¬åŠŸèƒ½
- ğŸ¨ TailwindCSS ç®¡ç†ç•Œé¢
- ğŸ”Œ å®Œæ•´çš„ REST API æ¥å£
- ğŸ“Š å®æ—¶ç»Ÿè®¡å’Œæ—¥å¿—åŠŸèƒ½

---

<div align="center">

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª Starï¼**

[ğŸ  é¦–é¡µ](../../) â€¢ [ğŸ“– æ–‡æ¡£](../../wiki) â€¢ [ğŸ› é—®é¢˜åé¦ˆ](../../issues) â€¢ [ğŸ’¬ è®¨è®º](../../discussions)

Made with â¤ï¸ by [yangweijie](https://github.com/yangweijie)

</div>
